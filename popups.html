<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF Popup Opener</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background-color: #f5f5f5;
      }

      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }

      .button-group {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      a {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        text-decoration: none;
        display: inline-block;
      }

      a:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        color: white;
      }

      a:active {
        transform: translateY(0);
      }

      .instructions {
        background: #e7f3ff;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        border-left: 4px solid #2196f3;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>PDF Popup Window Opener</h1>

      <div class="instructions">
        <strong>Open & focus new tab:</strong>
        <ul>
          <li>
            Click "Open Sample PDF" to open a sample PDF document in a popup
            window
          </li>
          <li>
            Click "Open About blank" to open a simple Hello World page in a
            popup window
          </li>
          <li>
            Click "Open PDF After 3s" to open a PDF document after a 3-second
            delay
          </li>
          <li>
            If a popup is already open, clicking the button will focus on the
            existing window
          </li>
        </ul>
      </div>

      <div class="button-group">
        <a
          href="https://qa-tools-appsulate.onrender.com/assets/PDF_Form_File.pdf"
          id="openSamplePDF"
          >Open Sample PDF</a
        >
        <a href="#" id="openAboutBlank">Open About blank</a>
        <a href="#" id="openPDFAfter3s">Open PDF After 3s</a>
      </div>

      <div class="instructions" style="margin-top: 30px">
        <strong>Open & focus + navigation in new tab:</strong>
        <ul>
          <li>
            Click "Focus PDF & Navigate" to focus the PDF popup (or open it if
            closed) and reload the PDF document
          </li>
          <li>
            Useful for testing popup focus behavior and page reloading
            functionality
          </li>
        </ul>
      </div>

      <div class="button-group">
        <a href="#" id="focusPDFAndNavigate">Focus PDF & Navigate</a>
      </div>
    </div>

    <script>
      // Configuration object for all popup settings
      const CONFIG = {
        urls: {
          samplePDF:
            "https://qa-tools-appsulate.onrender.com/assets/PDF_Form_File.pdf",
          microsoftLogin: "https://login.microsoftonline.com",
        },
        windowSettings: {
          pdf: "width=1000,height=700,scrollbars=yes,resizable=yes,menubar=yes,toolbar=yes,location=yes,status=yes",
          helloWorld:
            "width=600,height=400,scrollbars=yes,resizable=yes,menubar=yes,toolbar=yes,location=yes,status=yes",
        },
        helloWorldContent: `
          <!DOCTYPE html>
          <html>
          <head>
            <title>Hello World</title>
            <style>
              body {
                font-family: Arial, sans-serif;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                margin: 0;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
              }
              h1 {
                font-size: 3em;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                animation: fadeIn 2s ease-in;
              }
              @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
              }
            </style>
          </head>
          <body>
            <h1>Hello World!</h1>
          </body>
          </html>
        `,
      };

      // PopupManager class to handle all popup operations
      class PopupManager {
        constructor() {
          this.popups = new Map();
        }

        // Check if a popup exists and is still open
        getExistingPopup(name) {
          if (this.popups.has(name)) {
            const popup = this.popups.get(name);
            if (!popup.closed) {
              return popup;
            } else {
              this.popups.delete(name);
            }
          }
          return null;
        }

        // Create and track a new popup window
        createPopup(url, name, windowSettings) {
          const popup = window.open(url, name, windowSettings);

          if (!popup) {
            throw new Error("Popup was blocked by browser");
          }

          this.popups.set(name, popup);
          popup.focus();

          // Clean up when window is closed
          popup.addEventListener("beforeunload", () => {
            this.popups.delete(name);
          });

          return popup;
        }

        // Open or focus a popup with optional content
        openOrFocus(url, name, windowSettings, content = null) {
          try {
            // Check for existing popup
            const existingPopup = this.getExistingPopup(name);
            if (existingPopup) {
              existingPopup.focus();
              return existingPopup;
            }

            // Create new popup
            const popup = this.createPopup(url, name, windowSettings);

            // Write custom content if provided
            if (content) {
              popup.document.write(content);
              popup.document.close();
            }

            return popup;
          } catch (error) {
            return null;
          }
        }

        // Focus existing popup and navigate to URL
        focusAndNavigate(name, url) {
          try {
            const existingPopup = this.getExistingPopup(name);
            if (existingPopup) {
              existingPopup.focus();
              existingPopup.location.href = url;
              return existingPopup;
            }
            return null;
          } catch (error) {
            return null;
          }
        }
      }

      // Initialize popup manager
      const popupManager = new PopupManager();

      // Action functions - simplified and reusable
      function openSamplePDF() {
        try {
          popupManager.openOrFocus(
            CONFIG.urls.samplePDF,
            "samplePDF",
            CONFIG.windowSettings.pdf
          );
        } catch (error) {
          console.error("Error opening sample PDF:", error);
        }
      }

      function openAboutBlank() {
        try {
          popupManager.openOrFocus(
            "about:blank",
            "helloWorld",
            CONFIG.windowSettings.helloWorld,
            CONFIG.helloWorldContent
          );
        } catch (error) {
          console.error("Error opening about blank:", error);
        }
      }

      function focusPDFAndNavigate() {
        try {
          const existingPopup = popupManager.focusAndNavigate(
            "samplePDF",
            CONFIG.urls.samplePDF
          );
          if (!existingPopup) {
            // Create new popup if none exists
            const newPopup = popupManager.openOrFocus(
              CONFIG.urls.samplePDF,
              "samplePDF",
              CONFIG.windowSettings.pdf
            );
            if (newPopup) {
              setTimeout(() => {
                newPopup.location.href = CONFIG.urls.samplePDF;
              }, 500);
            }
          }
        } catch (error) {
          console.error("Error focusing PDF and navigate:", error);
        }
      }

      function openPDFAfter3s() {
        try {
          // Show a countdown or feedback to the user
          const button = document.getElementById("openPDFAfter3s");
          const originalText = button.textContent;
          button.textContent = "Opening in 3s...";
          button.style.opacity = "0.7";

          setTimeout(() => {
            button.textContent = "Opening in 2s...";
          }, 1000);

          setTimeout(() => {
            button.textContent = "Opening in 1s...";
          }, 2000);

          setTimeout(() => {
            popupManager.openOrFocus(
              CONFIG.urls.samplePDF,
              "delayedPDF",
              CONFIG.windowSettings.pdf
            );
            button.textContent = originalText;
            button.style.opacity = "1";
          }, 3000);
        } catch (error) {
          console.error("Error opening delayed PDF:", error);
          // Reset button state on error
          const button = document.getElementById("openPDFAfter3s");
          button.textContent = "Open PDF After 3s";
          button.style.opacity = "1";
        }
      }

      // Event listeners - clean separation of concerns
      document.addEventListener("DOMContentLoaded", () => {
        try {
          document
            .getElementById("openSamplePDF")
            .addEventListener("click", (e) => {
              e.preventDefault();
              openSamplePDF();
            });

          document
            .getElementById("openAboutBlank")
            .addEventListener("click", (e) => {
              e.preventDefault();
              openAboutBlank();
            });

          document
            .getElementById("focusPDFAndNavigate")
            .addEventListener("click", (e) => {
              e.preventDefault();
              focusPDFAndNavigate();
            });

          document
            .getElementById("openPDFAfter3s")
            .addEventListener("click", (e) => {
              e.preventDefault();
              openPDFAfter3s();
            });
        } catch (error) {
          console.error("Error setting up event listeners:", error);
        }
      });
    </script>
  </body>
</html>
